---
id: faq-5
title: PAG 内存占用
---

---

> ### 问：在 iOS 上测试了一个 PAG 动画播放，为什么内存占用有 100 多 M 那么大？
PAG 是纯 GPU 渲染的方案，任何一个 GPU 渲染的方案都会有一个初始的屏幕缓冲区开销，如果测试的时候是全屏的，每个像素都需要占用 4 字节的内存，加上双缓冲整体还要乘以 2，已经占用了几十 M 内存了。这个本身不是 PAG 动画占用的内存，而是任何 GPU 渲染方案的基本占用，但是它并不是线性增长的。PAG 提供了合并渲染的能力，你只需要创建一个 PAGView 就可以绘制无数个 PAG 动画文件上去，举个例子，共享 PAGView 的情况下，初始开销可能是几十 M，但是每增加一个 PAG 动画文件可能只增加几 M，所以不能通过一个全屏的 PAGView 测试单个 PAG 文件播放的内存占用来推理 N 个 PAG 动画的内存占用。要放到实际业务场景中进行测试才有意义。

实际业务场景通常是分这两种情况：

1.渲染的数量特别巨大，同屏可能有几十个上百个动画。这种场景下应该只创建一个 PAGView， 把 N 个动画文件合并渲染到同一个 PAGView 上，可以实现很少的内存占用就完美支持巨大数量的动画渲染。另外如果是在直播或者视频编辑里，本身已经创建过一个初始的 OpenGL 环境，还可以让 PAG 复用这个环境进行离屏渲染，也就不存在双缓冲的初始内存占用了。其实使用系统 UI 的 API 进行渲染没有额外双缓冲开销也是一样的原理，因为系统已经创建了一个全局默认的。

2.渲染的数量不多或者面积不大。这种场景下因为总面积不大，即使用了多个 PAGView，双缓冲中的额外内存占用其实也没有构成内存瓶颈，也就没有必要去做合并渲染的优化。直接正常使用 PAGView 即可。但是如果你本来就能够复用一个 PAGView 同时播放多个动画的，建议还是放在一起渲染，内存会进一步降低，性能也会更好。

总结一下：通过构造一个全屏的 PAGView 播放动画的测试 Demo，无法推理出实际的内存占用情况，建议按实际场景里出现的数量和动画最终使用面积来测试真实的内存占用。如果已经是按以上方式在真实场景下进行的内存测试，依然很高。那么问题可能出现在素材上。不同的素材本身内存占用也会有很大的区别。通常情况下过多使用 BMP 预合成会导致内存增量变高很多，因为涉及视频解码，会缓存非常多帧的内存。建议参考官网的[素材优化指南](https://pag.io/docs/optimization.html)来进行针对性优化。如果问题还是无法解决，可以再通过 QQ 群联系我们围绕具体 case 分析解决。

---